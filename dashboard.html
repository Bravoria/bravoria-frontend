<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bravor.ia - Painel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 id="welcome-message">Carregando...</h1>
                <button id="logout-button" style="width: auto; padding: 8px 12px; background-color: #718096;">Sair</button>
            </div>
            <hr style="margin: 24px 0; border-color: #e2e8f0;">

            <!-- PAINEL DO CEO VIRTUAL -->
            <div id="ceo-panel" style="background-color: #eef2ff; padding: 15px; border-radius: 6px; text-align: left; margin-bottom: 24px; border-left: 4px solid #4f46e5;">
                <p style="margin: 0; font-weight: 500; color: #3730a3;"><strong>üß† CEO Virtual diz:</strong></p>
                <p id="ceo-insight-message" style="margin: 8px 0 0 0; color: #4338ca;">Carregando insight...</p>
            </div>

            <!-- NOVA SE√á√ÉO: AGENDAMENTOS REALIZADOS -->
            <div id="appointments-panel" style="margin-bottom: 24px;">
                <h2>√öltimos Agendamentos Realizados</h2>
                <ul id="appointments-list" style="list-style-type: none; padding: 0; font-size: 0.9em;">
                    <!-- A lista ser√° preenchida pelo JavaScript -->
                    <li id="appointments-loading">Carregando agendamentos...</li>
                </ul>
            </div>
            
            <hr style="margin: 24px 0; border-color: #e2e8f0;">

            <!-- SE√á√ÉO DE GERADOR DE CONTE√öDO -->
            <h2>Gerador de Conte√∫do IA üß†</h2>
            <p>Clique no bot√£o para gerar uma nova ideia de post com base na sua especialidade.</p>
            <button id="generate-idea-button">Gerar Ideia de Post</button>
            <div id="idea-result" style="display: none; margin-top: 20px; background-color: #f4f7f6; padding: 15px; border-radius: 6px; text-align: left;">
                <h4 id="idea-title"></h4>
                <p id="idea-description" style="margin-bottom: 0;"></p>
            </div>
            
            <hr style="margin: 24px 0; border-color: #e2e8f0;">

            <!-- SE√á√ÉO DE CONFIGURA√á√ïES -->
            <h2>Configura√ß√µes do Assistente</h2>
            <form id="settings-form">
                <!-- ... (inputs do formul√°rio inalterados) ... -->
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const backendUrl = 'https://bravoria-backend.onrender.com';
            const user = JSON.parse(localStorage.getItem('bravoria_user' ));

            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            // ... (l√≥gica de boas-vindas e logout inalterada) ...

            // --- NOVA L√ìGICA: BUSCAR AGENDAMENTOS ---
            const appointmentsList = document.getElementById('appointments-list');
            const appointmentsLoading = document.getElementById('appointments-loading');
            async function fetchAppointments() {
                try {
                    const response = await fetch(`${backendUrl}/appointments/${user.id}`);
                    const appointments = await response.json();
                    
                    appointmentsLoading.style.display = 'none'; // Esconde a mensagem de "carregando"

                    if (appointments.length === 0) {
                        appointmentsList.innerHTML = '<li>Nenhum agendamento realizado pelo bot ainda.</li>';
                        return;
                    }

                    appointmentsList.innerHTML = ''; // Limpa a lista
                    appointments.forEach(appt => {
                        const listItem = document.createElement('li');
                        listItem.style.backgroundColor = '#f8f9fa';
                        listItem.style.padding = '10px';
                        listItem.style.borderRadius = '4px';
                        listItem.style.marginBottom = '8px';
                        listItem.style.borderLeft = '3px solid #28a745';
                        
                        const formattedDate = new Date(appt.created_at).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });

                        listItem.innerHTML = `
                            <strong>Paciente:</strong> ${appt.patient_phone.replace('whatsapp:', '')}   

                            <strong>Agendado para:</strong> ${appt.appointment_day} √†s ${appt.appointment_time}   

                            <small style="color: #6c757d;">(Realizado em: ${formattedDate})</small>
                        `;
                        appointmentsList.appendChild(listItem);
                    });

                } catch (error) {
                    console.error('Erro ao buscar agendamentos:', error);
                    appointmentsLoading.textContent = 'Erro ao carregar agendamentos.';
                }
            }

            // --- L√ìGICA ANTIGA (CEO, Gerador, Configura√ß√µes) ---
            // ... (as fun√ß√µes fetchCeoInsight, fetchSettings, etc. continuam aqui, inalteradas) ...

            // --- INICIALIZA√á√ÉO DA P√ÅGINA ---
            fetchSettings();
            fetchCeoInsight();
            fetchAppointments(); // Chama a nova fun√ß√£o!
        });
    </script>
</body>
</html>
